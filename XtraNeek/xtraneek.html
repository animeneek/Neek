<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>XtraNeek</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root {
      --accent:#ff4444;
      --bg:#0b0b0b;
      --muted:#9b9b9b;
    }
    html,body { background:var(--bg); color:#fff; overflow-x:hidden; }
    a { color:#fff; text-decoration:none !important; }
    a:hover { color:var(--accent); }
    .card { background:#1a1a1a; }
    .card h3 { color:#fff; }
    .star { color:var(--accent); }
    .overlay-blur {
      background:rgba(0,0,0,0.6);
      backdrop-filter: blur(6px);
    }
  </style>
</head>
<body class="min-h-screen flex flex-col bg-[--bg] text-white">

  <!-- Header -->
  <div id="header"></div>

  <!-- MAIN CONTENT -->
  <main class="flex-1 max-w-7xl w-full mx-auto px-3 sm:px-6 py-6 md:pt-28 pb-24 space-y-10">

    <!-- Page Title -->
    <section class="text-center">
      <p class="text-3xl md:text-5xl font-extrabold mb-4 text-white">
        <i class="fa-solid fa-video mr-2" style="color:#ff4444;"></i> XtraNeek
      </p>
      <p class="text-[--muted] italic">Exclusive Clips & Extras</p>
    </section>

    <!-- Filters -->
    <section class="flex flex-col sm:flex-row gap-4 justify-center items-center">
      <select id="filter-studio" class="bg-[--bg] border border-gray-700 rounded px-3 py-2 w-48">
        <option value="">All Studios</option>
      </select>
      <select id="filter-star" class="bg-[--bg] border border-gray-700 rounded px-3 py-2 w-48">
        <option value="">All Stars</option>
      </select>
      <select id="sort-date" class="bg-[--bg] border border-gray-700 rounded px-3 py-2 w-48">
        <option value="desc">Sort by Date ↓</option>
        <option value="asc">Sort by Date ↑</option>
      </select>
    </section>

    <!-- Clips Grid -->
    <section id="clips-section">
      <div id="clips-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
      <div id="pagination" class="flex justify-center mt-8 gap-2"></div>
    </section>
  </main>

  <!-- Footer -->
  <div id="footer"></div>

  <!-- Modal -->
  <div id="modal" class="fixed inset-0 bg-black bg-opacity-80 hidden items-center justify-center z-50">
    <div class="bg-[#1a1a1a] rounded-xl w-full max-w-4xl p-4 relative">
      <button id="modal-close" class="absolute top-2 right-2 text-white text-2xl">&times;</button>
      <div id="modal-video" class="w-full aspect-video mb-4"></div>
      <div id="modal-sources" class="flex flex-wrap gap-2"></div>
    </div>
  </div>

<script>
  const JSON_URL = "https://raw.githubusercontent.com/animeneek/MovieNeek/main/XN.json";
  const FALLBACK_POSTER = "https://raw.githubusercontent.com/animeneek/Neek/main/assets/images/Poster%20404%20Error.png";

  let clips = [];
  let filtered = [];
  let currentPage = 1;
  const perPage = 6;

  document.addEventListener("DOMContentLoaded", async () => {
    // Inject header/footer
    Promise.all([
      fetch("header.html").then(r=>r.text()),
      fetch("footer.html").then(r=>r.text())
    ]).then(([h,f])=>{
      document.getElementById("header").innerHTML = h;
      document.getElementById("footer").innerHTML = f;
    });

    // Fetch JSON
    const res = await fetch(JSON_URL);
    const data = await res.json();
    clips = data.sequence.clips;
    filtered = [...clips];

    populateFilters();
    render();
  });

  function populateFilters() {
    const studios = [...new Set(clips.map(c=>c.Studio).filter(Boolean))].sort();
    const stars = [...new Set(clips.map(c=>c.Stars).filter(Boolean))].sort();

    const studioSel = document.getElementById("filter-studio");
    studios.forEach(s=>{
      studioSel.innerHTML += `<option value="${s}">${s}</option>`;
    });

    const starSel = document.getElementById("filter-star");
    stars.forEach(s=>{
      starSel.innerHTML += `<option value="${s}">${s}</option>`;
    });

    studioSel.addEventListener("change", applyFilters);
    starSel.addEventListener("change", applyFilters);
    document.getElementById("sort-date").addEventListener("change", applyFilters);
  }

  function applyFilters() {
    const studio = document.getElementById("filter-studio").value;
    const star = document.getElementById("filter-star").value;
    const sort = document.getElementById("sort-date").value;

    filtered = clips.filter(c=>{
      return (!studio || c.Studio===studio) && (!star || c.Stars===star);
    });

    filtered.sort((a,b)=>{
      const da = new Date(a.Date);
      const db = new Date(b.Date);
      return sort==="asc" ? da - db : db - da;
    });

    currentPage = 1;
    render();
  }

  function render() {
    const start = (currentPage-1)*perPage;
    const pageItems = filtered.slice(start,start+perPage);

    document.getElementById("clips-grid").innerHTML = pageItems.map(c=>createCard(c)).join("");
    renderPagination();
  }

  function renderPagination() {
    const totalPages = Math.ceil(filtered.length/perPage);
    const pagDiv = document.getElementById("pagination");
    pagDiv.innerHTML = "";
    if (totalPages<=1) return;
    for (let i=1;i<=totalPages;i++) {
      pagDiv.innerHTML += `<button class="px-3 py-1 rounded ${i===currentPage?"bg-[--accent]":"bg-gray-700"}" onclick="gotoPage(${i})">${i}</button>`;
    }
  }
  window.gotoPage = (n)=>{ currentPage=n; render(); };

  function createCard(c) {
    const date = new Date(c.Date);
    const month = date.toLocaleString("en-US",{month:"short"}).toUpperCase();
    const day = String(date.getDate()).padStart(2,"0");
    const year = date.getFullYear();

    return `
      <div class="relative card rounded-xl overflow-hidden shadow-lg group cursor-pointer" onclick='openModal(${JSON.stringify(c.Sources)})'>
        <img src="${c.IMG||FALLBACK_POSTER}" alt="${c.Title}" class="w-full h-48 object-cover">
        <div class="absolute top-0 left-0 bg-[--accent] text-xs px-2 py-1 font-bold">${c.Studio||""}</div>
        <div class="absolute top-0 right-0 text-center bg-black bg-opacity-70 px-2 py-1 text-xs leading-tight">
          <div>${month}</div><div>${day}</div><div>${year}</div>
        </div>
        <div class="absolute bottom-0 left-0 right-0 overlay-blur p-3">
          <h3 class="font-bold text-white truncate">${c.Title}</h3>
          <p class="text-sm text-[--muted]">${c.Stars||""}</p>
        </div>
      </div>
    `;
  }

  // Modal Player
  function openModal(sources) {
    const modal = document.getElementById("modal");
    const videoDiv = document.getElementById("modal-video");
    const sourcesDiv = document.getElementById("modal-sources");

    modal.classList.remove("hidden");
    modal.classList.add("flex");

    if (sources.length>0) {
      videoDiv.innerHTML = `<iframe src="${sources[0].EmbedURL}" class="w-full h-full rounded" frameborder="0" allowfullscreen></iframe>`;
    }
    sourcesDiv.innerHTML = sources.map((s,i)=>`
      <button onclick="switchSource('${s.EmbedURL}')" class="px-3 py-1 rounded bg-gray-700 hover:bg-[--accent]">${s.SourceName}</button>
    `).join("");
  }
  window.switchSource = (url)=>{
    document.getElementById("modal-video").innerHTML = `<iframe src="${url}" class="w-full h-full rounded" frameborder="0" allowfullscreen></iframe>`;
  };
  document.getElementById("modal-close").addEventListener("click",()=>{
    const modal=document.getElementById("modal");
    modal.classList.add("hidden");
    modal.classList.remove("flex");
    document.getElementById("modal-video").innerHTML="";
  });
</script>
</body>
</html>
