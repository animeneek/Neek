<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Neek — Anime Info</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root {
      --accent: #ff4444;
      --bg: #0b0b0b;
      --muted: #9b9b9b;
    }
    html, body { background: var(--bg); color: #fff; overflow-x: hidden; }
    a { color: #fff; text-decoration: none !important; }
    a:hover { color: var(--accent); }
    .star { color: var(--accent); }
  </style>
</head>
<body class="min-h-screen flex flex-col bg-[--bg] text-white">

  <!-- Header -->
  <div id="header"></div>

  <main class="flex-1 max-w-6xl w-full mx-auto px-3 sm:px-6 py-6 md:pt-28 pb-24">
    
    <!-- Info -->
    <section id="info" class="flex flex-col md:flex-row gap-6 items-start"></section>

    <!-- Characters & VA -->
    <section id="characters" class="mt-10">
      <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
        <i class="fa fa-users text-[--accent]"></i> Characters & Voice Actors
      </h2>
      <div id="characters-grid" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3"></div>
    </section>

    <!-- Staff -->
    <section id="staff" class="mt-10">
      <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
        <i class="fa fa-user-tie text-[--accent]"></i> Staff
      </h2>
      <div id="staff-grid" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3"></div>
    </section>

    <!-- Recommended -->
    <section id="recommendations" class="mt-10">
      <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
        <i class="fa fa-clone text-[--accent]"></i> Recommended
      </h2>
      <div id="recommendations-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4"></div>
    </section>
  </main>

  <!-- Footer -->
  <div id="footer"></div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");
    const type = params.get("type");
    const ANILIST_API = "https://graphql.anilist.co";

    const FALLBACK_IMG = "https://github.com/animeneek/Neek/blob/main/assets/images/Poster%20404%20Error.png?raw=true";

    const query = `
      query($id: Int) {
        Media(id: $id, type: ANIME) {
          id
          title { romaji english native }
          description(asHtml: false)
          coverImage { large }
          bannerImage
          startDate { year }
          episodes
          averageScore
          characters(sort: ROLE, perPage: 12) {
            edges {
              role
              node {
                id
                name { full }
                image { large }
              }
              voiceActors(language: JAPANESE, sort: RELEVANCE) {
                id
                name { full }
                image { large }
              }
            }
          }
          staff(perPage: 12) {
            edges {
              role
              node {
                id
                name { full }
                image { large }
              }
            }
          }
          recommendations(perPage: 10) {
            edges {
              node {
                mediaRecommendation {
                  id
                  title { romaji }
                  coverImage { large }
                  averageScore
                }
              }
            }
          }
        }
      }
    `;

    async function fetchAnime() {
      const res = await fetch(ANILIST_API, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ query, variables: { id: Number(id) } })
      });
      const json = await res.json();
      renderAnime(json.data.Media);
    }

    function renderAnime(media) {
      // Info
      document.getElementById("info").innerHTML = `
        <div class="flex-shrink-0 w-full md:w-64">
          <img src="${media.coverImage?.large || FALLBACK_IMG}" class="rounded-xl shadow-lg w-full object-cover" />
        </div>
        <div class="flex-1">
          <h1 class="text-2xl sm:text-3xl font-bold mb-2">${media.title.romaji || media.title.english}</h1>
          <p class="text-sm text-gray-300 mb-3">
            Anime | ${media.startDate?.year || "—"}
            <span class="mx-2">|</span>
            Episodes: ${media.episodes || "?"}
            <span class="mx-2">|</span>
            <i class="fa fa-star star"></i> ${media.averageScore || "—"}
          </p>
          <p class="text-[--muted] mb-6">${media.description || "No description available."}</p>
        </div>
      `;

      // Characters & Voice Actors
      const chars = media.characters?.edges || [];
      document.getElementById("characters-grid").innerHTML = chars.map(edge => {
        const char = edge.node;
        const va = edge.voiceActors?.[0];
        return `
          <div class="bg-[#1a1a1a] rounded-xl p-3 flex justify-between items-start gap-3">
            <a href="character.html?id=${char.id}" class="flex items-center gap-3">
              <img src="${char.image?.large || FALLBACK_IMG}" class="w-16 h-20 rounded-lg object-cover"/>
              <div>
                <p class="font-bold">${char.name.full}</p>
                <p class="text-xs text-gray-400">${edge.role}</p>
              </div>
            </a>
            ${va ? `
              <a href="staff.html?id=${va.id}" class="flex items-center gap-2">
                <div class="text-right">
                  <p class="font-medium">${va.name.full}</p>
                  <p class="text-xs text-gray-400">VA</p>
                </div>
                <img src="${va.image?.large || FALLBACK_IMG}" class="w-12 h-16 rounded-lg object-cover"/>
              </a>
            ` : ""}
          </div>
        `;
      }).join("");

      // Staff
      const staff = media.staff?.edges || [];
      document.getElementById("staff-grid").innerHTML = staff.map(edge => {
        const st = edge.node;
        return `
          <a href="staff.html?id=${st.id}" class="bg-[#1a1a1a] rounded-xl p-3 flex items-center gap-3">
            <img src="${st.image?.large || FALLBACK_IMG}" class="w-16 h-20 rounded-lg object-cover"/>
            <div>
              <p class="font-bold">${st.name.full}</p>
              <p class="text-xs text-gray-400">${edge.role}</p>
            </div>
          </a>
        `;
      }).join("");

      // Recommendations
      const recs = media.recommendations?.edges || [];
      document.getElementById("recommendations-grid").innerHTML = recs.map(r => {
        const rec = r.node.mediaRecommendation;
        return `
          <a href="info.html?id=${rec.id}&type=anime" class="block rounded-xl overflow-hidden hover:scale-105 transition bg-[#1a1a1a]">
            <img src="${rec.coverImage?.large || FALLBACK_IMG}" class="w-full h-72 object-cover" />
            <div class="p-2">
              <p class="text-sm font-bold line-clamp-1">${rec.title.romaji}</p>
              <p class="text-xs text-gray-400"><i class="fa fa-star star"></i> ${rec.averageScore || "—"}</p>
            </div>
          </a>
        `;
      }).join("");
    }

    fetchAnime();
  </script>
</body>
</html>
