<!-- Put this script (replace your old Promise.all block) -->
<script>
(async function insertHeaderFooterAndInit() {
  // fetch header & footer HTML
  const [headerHtml, footerHtml] = await Promise.all([
    fetch("header.html").then(r => r.ok ? r.text() : ""),
    fetch("footer.html").then(r => r.ok ? r.text() : "")
  ]);

  // insert
  if (headerHtml) document.getElementById("header").innerHTML = headerHtml;
  if (footerHtml) document.getElementById("footer").innerHTML = footerHtml;

  // small init after DOM insertion
  const headerEl = document.querySelector(".neek-header");
  // ensure header exists
  if (!headerEl) return;

  // 1) Set safe body padding on desktop so fixed header won't overlap content
  const applyHeaderPadding = () => {
    if (window.matchMedia("(min-width: 768px)").matches) {
      const h = headerEl.getBoundingClientRect().height || 64;
      document.body.style.paddingTop = h + "px";
    } else {
      document.body.style.paddingTop = ""; // remove on small screens
    }
  };
  applyHeaderPadding();
  window.addEventListener("resize", applyHeaderPadding);

  // 2) ensure no horizontal scroll
  document.documentElement.style.overflowX = "hidden";
  document.body.style.overflowX = "hidden";

  // 3) switch-link logic (Movies <-> Anime)
  try {
    const path = location.pathname.split("/").pop().toLowerCase();
    const isAnime = path.includes("anime");
    const switchLink = document.getElementById("switch-link");
    const switchLinkMobile = document.getElementById("switch-link-mobile");

    if (switchLink) {
      if (isAnime) {
        switchLink.textContent = "Movies & Series";
        switchLink.href = "movies.html";
      } else {
        switchLink.textContent = "Anime";
        switchLink.href = "anime.html";
      }
    }
    if (switchLinkMobile) {
      if (isAnime) {
        const span = switchLinkMobile.querySelector("span");
        if (span) span.textContent = "Movies";
        switchLinkMobile.href = "movies.html";
      } else {
        const span = switchLinkMobile.querySelector("span");
        if (span) span.textContent = "Anime";
        switchLinkMobile.href = "anime.html";
      }
    }
  } catch (e) {
    console.warn("switch-link init failed", e);
  }

  // 4) highlight active nav link (simple heuristic: match filename or 'anime'/'movies')
  try {
    const current = location.pathname.split("/").pop().toLowerCase() || "index.html";
    const isAnimePage = current.includes("anime");
    document.querySelectorAll(".neek-header nav a.neek-link, .neek-mobile-nav a.neek-link").forEach(a => {
      // normalize anchor href
      const href = (a.getAttribute("href") || "").split("/").pop().toLowerCase();
      a.classList.remove("text-[--accent]");
      a.classList.add("text-white");
      if (href && href === current) {
        a.classList.add("text-[--accent]");
        a.classList.remove("text-white");
      } else {
        // additional heuristic: if on anime page, highlight anime-related anchors
        if (isAnimePage && href && href.includes("anime")) {
          a.classList.add("text-[--accent]");
          a.classList.remove("text-white");
        }
        // if on movies, highlight movie anchors
        if (!isAnimePage && href && (href.includes("movie") || href.includes("movies") || href.includes("trendingmovies"))) {
          a.classList.add("text-[--accent]");
          a.classList.remove("text-white");
        }
      }
    });
  } catch (e) {
    console.warn("active highlight failed", e);
  }

})();
</script>
