<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Neek — People</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root {
      --accent: #ff4444;
      --bg: #0b0b0b;
      --muted: #9b9b9b;
    }

    html, body {
      background: var(--bg);
      color: #fff;
      overflow-x: hidden; /* prevent sideways scroll */
    }

    a { color: #fff; text-decoration: none !important; }
    a:hover { color: var(--accent); text-decoration: none !important; }

    .star { color: var(--accent); }
    .poster-img { max-width: 100%; height: auto; }

    .tab {
      cursor: pointer;
      padding: 0.5rem 1rem;
      font-weight: 600;
      border-bottom: 2px solid transparent;
      white-space: nowrap;
    }
    .tab-active {
      color: var(--accent);
      border-bottom-color: var(--accent);
    }
  </style>
</head>
<body class="min-h-screen flex flex-col bg-[--bg] text-white">

  <!-- Header -->
  <div id="header"></div>

  <main class="flex-1 max-w-6xl w-full mx-auto px-3 sm:px-6 py-6 md:pt-28 pb-24">

    <!-- Person Info -->
    <section id="person" class="flex flex-col md:flex-row gap-6 items-start"></section>

    <!-- Known For -->
    <section id="knownfor" class="mt-10">
      <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
        <i class="fa fa-film text-[--accent]"></i> Known For
      </h2>
      <div id="dept-tabs" class="flex gap-4 border-b border-gray-700 mb-6 overflow-x-auto"></div>
      <div id="credits-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4"></div>
    </section>
  </main>

  <!-- Footer -->
  <div id="footer"></div>

  <!-- Header/footer script -->
  <script>
    (async function insertHeaderFooterAndInit() {
      try {
        const [hHtml, fHtml] = await Promise.all([
          fetch('header.html').then(r => r.ok ? r.text() : ''),
          fetch('footer.html').then(r => r.ok ? r.text() : '')
        ]);
        if (hHtml) document.getElementById('header').innerHTML = hHtml;
        if (fHtml) document.getElementById('footer').innerHTML = fHtml;
      } catch (e) {
        console.warn('header/footer load failed', e);
      }

      // adjust padding-top so content doesn’t overlap header
      const tryApplyPadding = () => {
        const headerEl = document.querySelector('.neek-header');
        if (!headerEl) return;
        if (window.matchMedia('(min-width: 768px)').matches) {
          const h = headerEl.getBoundingClientRect().height || 64;
          document.body.style.paddingTop = h + 'px';
        } else {
          document.body.style.paddingTop = '';
        }
      };
      tryApplyPadding();
      window.addEventListener('resize', tryApplyPadding);
    })();
  </script>

  <!-- Main logic -->
  <script>
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");
    const API_KEY = "e3afd4c89e3351edad9e875ff7a01f0c";
    const IMG = "https://image.tmdb.org/t/p/w500";
    const FALLBACK_POSTER = "https://github.com/animeneek/Neek/blob/main/assets/images/Poster%20404%20Error.png?raw=true";

    // helpers
    const safe = (v, f='—') => (v===null||v===undefined||v==='')?f:v;
    const getYear = d => d ? (d.split("-")[0] || d) : "—";
    const escapeHtml = s => !s ? "" : String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");

    (async function init() {
      if (!id) return;

      // person details
      const res = await fetch(`https://api.themoviedb.org/3/person/${id}?api_key=${API_KEY}&language=en-US`);
      const person = await res.json();
      renderPerson(person);

      // combined credits
      const res2 = await fetch(`https://api.themoviedb.org/3/person/${id}/combined_credits?api_key=${API_KEY}&language=en-US`);
      const credits = await res2.json();
      renderCredits(credits);
    })();

    function renderPerson(data) {
      const img = data.profile_path ? IMG+data.profile_path : FALLBACK_POSTER;
      const html = `
        <div class="flex-shrink-0 w-full md:w-64">
          <img src="${img}" alt="${escapeHtml(data.name)}" class="rounded-xl shadow-lg poster-img w-full h-auto object-cover" />
        </div>
        <div class="flex-1">
          <h1 class="text-2xl sm:text-3xl font-bold mb-2 break-words">${escapeHtml(data.name)}</h1>
          <p class="text-sm text-gray-300 mb-3">
            <i class="fa-regular fa-calendar mr-1"></i> <span class="text-white">${safe(data.birthday)}</span>
            ${data.place_of_birth ? `<span class="mx-2">|</span> <i class="fa fa-map-marker-alt mr-1"></i> <span class="text-white">${escapeHtml(data.place_of_birth)}</span>` : ""}
          </p>
          <p class="text-[--muted] mb-6 whitespace-pre-line">${escapeHtml(safe(data.biography,"No biography available"))}</p>
        </div>`;
      document.getElementById("person").innerHTML = html;
    }

    function renderCredits(data) {
      const all = [...(data.cast||[]), ...(data.crew||[])];

      // group by department
      const grouped = {};
      all.forEach(item => {
        const dept = item.department || "Acting";
        if (!grouped[dept]) grouped[dept] = [];
        grouped[dept].push(item);
      });

      // sort each group: latest first
      for (const dept in grouped) {
        grouped[dept].sort((a,b)=>{
          const da = new Date(a.release_date || a.first_air_date || "0000");
          const db = new Date(b.release_date || b.first_air_date || "0000");
          return db - da;
        });
      }

      // tabs
      const tabsEl = document.getElementById("dept-tabs");
      const gridEl = document.getElementById("credits-grid");
      const depts = Object.keys(grouped);
      let activeDept = depts[0] || "";

      function renderTabs() {
        tabsEl.innerHTML = depts.map(d=>{
          const count = grouped[d].length;
          const active = d===activeDept ? "tab-active" : "";
          return `<div class="tab ${active}" data-dept="${d}">${d} (${count})</div>`;
        }).join("");
      }

      function renderGrid() {
        const arr = grouped[activeDept] || [];
        gridEl.innerHTML = arr.map(it=>{
          const poster = it.poster_path?IMG+it.poster_path:FALLBACK_POSTER;
          const title = escapeHtml(it.title||it.name||"—");
          const mediaType = it.media_type==="movie"?"movie":"series";
          const year = getYear(it.release_date||it.first_air_date);
          const rating = it.vote_average?it.vote_average.toFixed(1):"N/A";
          const meta = mediaType==="movie"
            ? `Movie | ${year} | <i class="fa fa-star star"></i> ${rating}`
            : `Series | ${year} | <i class="fa fa-star star"></i> ${rating}`;
          return `
            <a href="info.html?id=${it.id}&type=${mediaType}" class="block rounded-xl overflow-hidden hover:scale-105 transition bg-[#1a1a1a]">
              <img src="${poster}" alt="${title}" class="w-full h-72 object-cover">
              <div class="p-2">
                <p class="text-sm font-bold line-clamp-1">${title}</p>
                <p class="text-xs text-gray-400">${meta}</p>
              </div>
            </a>`;
        }).join("");
      }

      renderTabs();
      renderGrid();

      tabsEl.addEventListener("click", e=>{
        const t = e.target.closest(".tab");
        if (!t) return;
        activeDept = t.dataset.dept;
        renderTabs();
        renderGrid();
      });
    }
  </script>
</body>
</html>
